SELECT * FROM BIRBANK.D_RMS_USEDPROMOCODE A WHERE A.FIN ='60CFME6';   ------- fin kod alanin fin kodudur
SELECT A.* FROM BIRBANK.D_RMS_LOYALTY_REFERRAL A WHERE A.REFERRAL_PIN='60CFME6';  ----fin kod alanin finidir
SELECT * FROM BIRBANK.F_RMS_PROMOCODE A  WHERE A.CMS_ID ='6062485'; ----MUSTERI UZRE CEDVEL fin kodu ve cms id-si
 


---A.PROMO_CODE = '86X0PU';  C.PIN = '63A8D5E' ;
--'86X0PU' ;  ---- PROMOCODE TO PIN WHO ACCEPTED PROMO 
--- WHERE A.PROMO_CODE ='0C31VK' ;  ----CMS ID TO CUSTOMER
---CMS_ID + AMOUNT OF ACCEPTER + PIN
---WHERE  C.PIN = '2HFW2SQ' ;


SELECT d.*
  FROM DWH.D_CUSTOMER D
 INNER JOIN BIRBANK.F_RMS_PROMOCODE A
    ON D.CMS_ID = A.CMS_ID
 INNER JOIN BIRBANK.D_RMS_USEDPROMOCODE B
    ON A.PROMO_CODE = B.PROMO_CODE
 INNER JOIN BIRBANK.D_RMS_LOYALTY_REFERRAL C
    ON B.PROMO_CODE = C.PROMO_CODE
 WHERE D.PIN = '60CFME6';

select /*+parallel */
 d.pin, d.full_name, sum(a.cashback_amount) summa
  from cms.f_cashback_transaction a
 inner join DWH.D_CUSTOMER D
    on a.cms_id = d.cms_id
---inner join emp    on emp.fin = d.pin
 where TERMNAME = 'LOYALTY_REFERRAL_5'
   and DIRECTION = 'CREDIT'
 group by d.pin, d.full_name
 order by summa desc fetch first 10 rows only;
