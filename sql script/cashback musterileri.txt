
--- CASHBACK

select /*+parallel */
 d.pin, d.full_name, sum(a.cashback_amount) summa
  from cms.f_cashback_transaction a
 inner join DWH.D_CUSTOMER D
    on a.cms_id = d.cms_id
---inner join emp    on emp.fin = d.pin
 where 
 ---TERMNAME = 'LOYALTY_REFERRAL_5' and 
 DIRECTION = 'CREDIT'
   --AND D.PIN = '60CFME6'
 group by d.pin, d.full_name
 order by summa desc fetch first 10 rows only;
